version: '3.4'
services:
  dev:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: "/ml"
    environment:
      - "GOOGLE_CREDENTIALS=/key.json"
      - "TF_VAR_gcloud_project_id=personal-172200"
      - "TF_VAR_zone=asia-east1-c"
    volumes:
      - "./:/ml"
      - "~/keys/personal-172200.json:/key.json"
  apply:
    build:
      context: .
      dockerfile: Dockerfile
    working_dir: "/ml"
    command: "terraform apply"
    environment:
      - "GOOGLE_CREDENTIALS=/key.json"
      - "TF_VAR_gcloud_project_id=personal-172200"
      - "TF_VAR_zone=asia-east1-c"
    volumes:
      - "./:/ml"
      - "~/keys/personal-172200.json:/key.json"
